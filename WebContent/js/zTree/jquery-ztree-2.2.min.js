/*
 * JQuery zTree 2.2
 * http://code.google.com/p/jquerytree/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Date: 2010-12-15
 *
 */
(function(f){function db(a,b){b.unbind(da);b.bind(da,function(c,d,e){typeof a.callback.click=="function"&&a.callback.click(c,d,e)});b.unbind(ea);b.bind(ea,function(c,d,e){typeof a.callback.change=="function"&&a.callback.change(c,d,e)});b.unbind(fa);b.bind(fa,function(c,d,e){typeof a.callback.rename=="function"&&a.callback.rename(c,d,e)});b.unbind(ga);b.bind(ga,function(c,d,e){typeof a.callback.remove=="function"&&a.callback.remove(c,d,e)});b.unbind(ha);b.bind(ha,function(c,d,e){typeof a.callback.drag==
"function"&&a.callback.drag(c,d,e)});b.unbind(T);b.bind(T,function(c,d,e,g,h){typeof a.callback.drop=="function"&&a.callback.drop(c,d,e,g,h)});b.unbind(ia);b.bind(ia,function(c,d,e){typeof a.callback.expand=="function"&&a.callback.expand(c,d,e)});b.unbind(ja);b.bind(ja,function(c,d,e){typeof a.callback.collapse=="function"&&a.callback.collapse(c,d,e)});b.unbind(ka);b.bind(ka,function(c,d,e,g){typeof a.callback.asyncSuccess=="function"&&a.callback.asyncSuccess(c,d,e,g)});b.unbind(la);b.bind(la,function(c,
d,e,g,h,i){typeof a.callback.asyncError=="function"&&a.callback.asyncError(c,d,e,g,h,i)});f("#"+a.treeObjId).bind("contextmenu",function(c){var d=f(c.target);d=ma(a,d);var e=true;if(typeof a.callback.beforeRightClick=="function")e=a.callback.beforeRightClick(a.treeObjId,d);if(e&&typeof a.callback.rightClick=="function"){a.callback.rightClick(c,a.treeObjId,d);return false}return typeof a.callback.rightClick!="function"});f("#"+a.treeObjId).bind("mouseup",function(c){var d=f(c.target);d=ma(a,d);var e=
true;if(typeof a.callback.beforeMouseUp=="function")e=a.callback.beforeMouseUp(a.treeObjId,d);e&&typeof a.callback.mouseUp=="function"&&a.callback.mouseUp(c,a.treeObjId,d);return true});f("#"+a.treeObjId).bind("mousedown",function(c){var d=f(c.target);d=ma(a,d);var e=true;if(typeof a.callback.beforeMouseDown=="function")e=a.callback.beforeMouseDown(a.treeObjId,d);e&&typeof a.callback.mouseDown=="function"&&a.callback.mouseDown(c,a.treeObjId,d);return true})}function ma(a,b){var c;c=f(b);if(c.attr("id")==
a.treeObjId)c=null;else{for(;!c.is("li")&&c.attr("id")!=a.treeObjId;)c=c.parent();c=c.attr("id");c=U(a,c)}return c}function M(a,b,c,d){if(c)for(var e=0;e<c.length;e++){var g=c[e];g.level=b;g.tId=a.treeObjId+"_"+ ++na;g.parentNode=d;g[a.checkedCol]=g[a.checkedCol]==true;g.checkedOld=g[a.checkedCol];g.check_Focus=false;g.check_True_Full=true;g.check_False_Full=true;g.editNameStatus=false;g.isFirstNode=(d?d:a.root)[a.nodesCol].length==c.length&&e==0;g.isLastNode=e==c.length-1;if(g[a.nodesCol]&&g[a.nodesCol].length>
0){g.open=g.open?true:false;g.isParent=true;Ga(a,g);M(a,b+1,g[a.nodesCol],g)}else{g.isParent=g.isParent?true:false;Ga(a,g);a.checkable&&e==c.length-1&&V(a,g)}}}function Ga(a,b){var c=b.parentNode;c=c?f("#"+b.parentNode.tId+r):f("#"+a.treeObjId);c.append("<li id='"+b.tId+"' class='tree-node'><button type=\"button\" id='"+b.tId+v+"' title='' onfocus='this.blur();'></button><a id='"+b.tId+o+"' onclick=\""+(b.click||"")+'" ><button type="button" id=\''+b.tId+s+"' title='' onfocus='this.blur();'></button><span id='"+
b.tId+I+"'></span></a><ul id='"+b.tId+r+"'></ul></li>");c=f("#"+b.tId+v);var d=f("#"+b.tId+o);f("#"+b.tId+I);var e=f("#"+b.tId+r),g=f("#"+b.tId+s);Ha(a,b);C(a,b);e.css({display:b.open?"block":"none"});if(b.isParent){c.bind("click",{treeObjId:a.treeObjId,treeNode:b},W);d.bind("dblclick",{treeObjId:a.treeObjId,treeNode:b},W)}d.bind("click",function(){var i=true;if(typeof a.callback.beforeClick=="function")i=a.callback.beforeClick(a.treeObjId,b);if(i!=false){window.getSelection?window.getSelection().removeAllRanges():
document.selection.empty();N(a,b);f("#"+a.treeObjId).trigger(da,[a.treeObjId,b])}});g.bind("mousedown",function(){b.editNameStatus=false});if(a.checkable){c.after("<BUTTON type='BUTTON' ID='"+b.tId+D+"' onfocus='this.blur();' ></BUTTON>");var h=f("#"+b.tId+D);if(a.checkStyle==J&&a.checkRadioType==oa&&b[a.checkedCol])a.checkRadioCheckedList=a.checkRadioCheckedList.concat([b]);y(a,h,b);h.bind("click",function(){var i=true;if(typeof a.callback.beforeChange=="function")i=a.callback.beforeChange(a.treeObjId,
b);if(i!=false){b[a.checkedCol]=!b[a.checkedCol];Ia(a,b);y(a,h,b);O(a,b);f("#"+a.treeObjId).trigger(ea,[a.treeObjId,b])}});h.bind("mouseover",function(){b.checkboxFocus=true;y(a,h,b)});h.bind("mouseout",function(){b.checkboxFocus=false;y(a,h,b)})}Ja(b);Ka(a,b);a.editable&&d.hover(function(){if(a.dragStatus==0){X(b);Y(b);eb(a,b);fb(a,b)}},function(){X(b);Y(b)});d.bind("mousedown",function(i){if(!(i.button==2||!a.editable)){var p=document,t,k,j,w=null,m=null,x=z,P=i.clientX,gb=i.clientY,La=(new Date).getTime();
f(p).mousemove(function(l){if(b.editNameStatus)return true;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();if(a.dragStatus==0&&Math.abs(P-l.clientX)<Ma&&Math.abs(gb-l.clientY)<Ma)return true;f("body").css("cursor","pointer");f("#"+b.tId+v);if(a.dragStatus==0&&b.isParent&&b.open){B(a,b,!b.open);a.dragNodeShowBefore=true}if(a.dragStatus==0){a.dragStatus=-1;var q=true;if(typeof a.callback.beforeDrag=="function")q=a.callback.beforeDrag(a.treeObjId,b);if(q==false)return;
a.dragStatus=1;Na(true);N(a,b);X(b);Y(b);q=f("#"+b.tId).clone();q.attr("id",b.tId+"_tmp");q.css("padding","0");q.children("#"+b.tId+o).removeClass(pa);q.children("#"+b.tId+r).css("display","none");t=f("<ul class='zTreeDragUL'></ul>").append(q);t.attr("id",b.tId+r+"_tmp");t.addClass(f("#"+a.treeObjId).attr("class"));t.appendTo("body");k=f("<button class='tmpzTreeMove_arrow'></button>");k.attr("id","zTreeMove_arrow_tmp");k.appendTo("body");f("#"+a.treeObjId).trigger(ha,[a.treeObjId,b])}if(a.dragStatus==
1&&k.attr("id")!=l.target.id){if(j){j.removeClass(qa);m&&f("#"+m+o,j).removeClass(ra)}m=j=null;var n=a.treeObj.get(0).scrollHeight;a.treeObj.get(0);q=f(p).scrollTop();var F=f(p).scrollLeft(),u=a.treeObj.offset();if(l.clientY+q-u.top<10&&a.treeObj.scrollTop()>0)a.treeObj.scrollTop(a.treeObj.scrollTop()-10);else a.treeObj.height()+u.top-l.clientY-q<10&&a.treeObj.scrollTop()<n&&a.treeObj.scrollTop(a.treeObj.scrollTop()+10);if(l.target.id==a.treeObjId&&b.parentNode!=null){j=f("#"+a.treeObjId);j.addClass(qa)}else if(l.target.id&&
f("#"+a.treeObjId).find("#"+l.target.id).length>0){for(n=f("#"+l.target.id);!n.is("li")&&n.attr("id")!=a.treeObjId;)n=n.parent();u=false;if(b.parentNode&&n.attr("id")!=b.tId&&f("#"+b.tId).find("#"+n.attr("id")).length==0)u=true;else if(b.parentNode==null&&n.attr("id")!=b.tId&&f("#"+b.tId).find("#"+n.attr("id")).length==0)u=true;if(u){j=n;m=n.attr("id");f("#"+m+o,j).addClass(ra)}}t.css({top:l.clientY+q+3+"px",left:l.clientX+F+3+"px"});u=n=0;if(j&&j.attr("id")!=a.treeObjId){n=f("#"+b.tId).prev().attr("id")==
j.attr("id");u=f("#"+b.tId).next().attr("id")==j.attr("id");F=f("#"+m+o,j);l=(l.clientY+q-F.offset().top)/F.height();if(l<0.25&&l>=-0.2&&!u){n=1-k.width();u=0-k.height()/2;x=Q}else if(l>0.75&&l<=1.2&&!n){n=1-k.width();u=F.height()-k.height()/2;x=Z}else{n=5-k.width();u=0;x=z}k.css({display:"block",top:F.offset().top+u+"px",left:F.offset().left+n+"px"});if(w!=m)La=(new Date).getTime();this.moveTimer=setTimeout(function(){var $=U(a,m);$&&$.isParent&&!$.open&&(new Date).getTime()-La>500&&sa(a,$)},600)}else{x=
z;k.css({display:"none"});this.moveTimer&&clearTimeout(this.moveTimer)}w=m}return false});f(p).mouseup(function(){this.moveTimer&&clearTimeout(this.moveTimer);f(p).unbind("mousemove");f(p).unbind("mouseup");f("body").css("cursor","auto");if(j){j.removeClass(qa);m&&f("#"+m+o,j).removeClass(ra)}Na(false);if(a.dragStatus!=0){a.dragStatus=0;if(b.isParent&&a.dragNodeShowBefore&&!b.open){B(a,b,!b.open);a.dragNodeShowBefore=false}t&&t.remove();k&&k.remove();if(j&&m&&b.parentNode&&m==b.parentNode.tId&&x==
z)j=null;if(j){var l=m==null?null:U(a,m),q=true;if(typeof a.callback.beforeDrop=="function")q=a.callback.beforeDrop(a.treeObjId,b,l,x);if(q!=false){Oa(a,l,b,x);f("#"+a.treeObjId).trigger(T,[a.treeObjId,b,l,x])}}else f("#"+a.treeObjId).trigger(T,[a.treeObjId,null,null,null])}});i.preventDefault&&i.preventDefault()}})}function hb(a,b){if(a.setSelectionRange){a.focus();a.setSelectionRange(b,b)}else if(a.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",
b);c.select()}}function Na(a){for(;aa.length>0;){aa[0].remove();aa.shift()}if(a){a=f("iframe");for(var b=0;b<a.length;b++){var c=a.get(b),d;d=Array(2);oRect=c.getBoundingClientRect();d[0]=oRect.left;d[1]=oRect.top;d=d;c=f("<div id='zTreeMask_"+b+"' class='zTreeMask' style='top:"+d[1]+"px; left:"+d[0]+"px; width:"+c.offsetWidth+"px; height:"+c.offsetHeight+"px;'></div>");c.appendTo("body");aa.push(c)}}}function Ha(a,b){f("#"+b.tId+I).text(b[a.nameCol])}function Ja(a){f("#"+a.tId+o).attr("target",a.target||
"_blank")}function Ka(a,b){var c=f("#"+b.tId+o);b.url&&!a.editable?c.attr("href",b.url):c.removeAttr("href")}function C(a,b){if(b){var c=f("#"+b.tId+v);f("#"+b.tId+o);var d=f("#"+b.tId+r),e=f("#"+b.tId+s);c.attr("class","switch");if(a.showLine){if(b.level==0&&b.isFirstNode&&b.isLastNode)c.attr("class","switch_"+ta);else if(b.level==0&&b.isFirstNode)c.attr("class","switch_"+ua);else b.isLastNode?c.attr("class","switch_"+ba):c.attr("class","switch_"+Pa);b.isLastNode?d.removeClass(va):d.addClass(va)}else c.attr("class",
"switch_"+Qa);e.attr("class",b.iconSkin?b.iconSkin:"");if(b.isParent){d=b.open?"_"+G:"_"+H;c.attr("class",c.attr("class")+d);e.addClass("ico"+d)}else{c.attr("class",c.attr("class")+"_"+E);e.addClass("ico_"+E)}b.icon?e.attr("style","background:url("+b.icon+") 0 0 no-repeat;"):e.attr("style","")}}function A(a,b){if(a){var c=a.attr("class");if(c!=undefined){c=c.split("_");switch(b){case ta:case ua:case Pa:case ba:case Qa:c[1]=b;break;case G:case H:case E:c[2]=b}a.attr("class",c.join("_"))}}}function K(a,
b){if(a){var c=a.attr("class");if(c!=undefined){c=c.split("_");switch(b){case G:case H:case E:c[1]=b}a.attr("class",c.join("_"))}}}function X(a){f("#"+a.tId+R).unbind().remove()}function Y(a){f("#"+a.tId+L).unbind().remove()}function eb(a,b){if(!(b.editNameStatus||f("#"+b.tId+R).length>0)){var c=a.edit_renameBtn;if(typeof a.edit_renameBtn=="function")c=a.edit_renameBtn(b);if(c){c=f("#"+b.tId+o);var d="<button type='button' class='edit' id='"+b.tId+R+"' title='' onfocus='this.blur();' style='display:none;'></button>";
c.append(d);var e=f("#"+b.tId+R);if(a.treeObj.attr("offsetLeft")+a.treeObj.attr("offsetWidth")+a.treeObj.attr("scrollLeft")-c.attr("offsetLeft")-c.attr("offsetWidth")-2*e.width()-15<0){e.remove();c.prepend(d);e=f("#"+b.tId+R)}e.bind("click",function(){var g=true;if(typeof a.callback.beforeRename=="function")g=a.callback.beforeRename(a.treeObjId,b);if(g!=false){X(b);Y(b);b.editNameStatus=true;N(a,b);return false}}).bind("mousedown",function(){return true}).show()}}}function fb(a,b){if(!(!a.edit_removeBtn||
f("#"+b.tId+L).length>0)){var c=a.edit_removeBtn;if(typeof a.edit_removeBtn=="function")c=a.edit_removeBtn(b);if(c){c=f("#"+b.tId+o);var d="<button type='button' class='remove' id='"+b.tId+L+"' title='' onfocus='this.blur();' style='display:none;'></button>";c.append(d);var e=f("#"+b.tId+L);if(a.treeObj.attr("offsetLeft")+a.treeObj.attr("offsetWidth")-c.attr("offsetLeft")-c.attr("offsetWidth")-1*e.width()-15<0){e.remove();c.prepend(d);e=f("#"+b.tId+L)}f("#"+b.tId+L).bind("click",function(){var g=
true;if(typeof a.callback.beforeRemove=="function")g=a.callback.beforeRemove(a.treeObjId,b);if(g!=false){Ra(a,b);f("#"+a.treeObjId).trigger(ga,[a.treeObjId,b]);return false}}).bind("mousedown",function(){return true}).show()}}}function Ia(a,b){if(a.checkStyle==J)if(b[a.checkedCol])if(a.checkRadioType==oa){for(var c=a.checkRadioCheckedList.length-1;c>=0;c--){var d=a.checkRadioCheckedList[c];d[a.checkedCol]=false;a.checkRadioCheckedList.splice(c,1);y(a,f("#"+d.tId+D),d);d.parentNode!=b.parentNode&&
O(a,d)}a.checkRadioCheckedList=a.checkRadioCheckedList.concat([b])}else{c=b.parentNode?b.parentNode:a.root;for(var e=0;e<c[a.nodesCol].length;e++){d=c[a.nodesCol][e];if(d[a.checkedCol]&&d!=b){d[a.checkedCol]=false;y(a,f("#"+d.tId+D),d)}}}else{if(a.checkRadioType==oa)for(c=0;c<a.checkRadioCheckedList.length;c++)if(b==a.checkRadioCheckedList[c]){a.checkRadioCheckedList.splice(c,1);break}}else{if(b[a.checkedCol]&&a.checkType.Y.indexOf("s")>-1){ca(a,b,true);wa(a,b)}b[a.checkedCol]&&a.checkType.Y.indexOf("p")>
-1&&xa(a,b,true);if(!b[a.checkedCol]&&a.checkType.N.indexOf("s")>-1){ca(a,b,false);wa(a,b)}!b[a.checkedCol]&&a.checkType.N.indexOf("p")>-1&&xa(a,b,false)}}function y(a,b,c){if(b){b.removeClass();a=a.checkStyle+"_"+(c[a.checkedCol]?ib:jb)+"_"+(c[a.checkedCol]||a.checkStyle==J?c.check_True_Full?Sa:Ta:c.check_False_Full?Sa:Ta);a=c.checkboxFocus?a+"_"+kb:a;b.addClass(lb);b.addClass(a)}}function V(a,b){if(b&&b.parentNode){ya(a,b.parentNode);V(a,b.parentNode)}}function O(a,b){b[a.nodesCol]&&b[a.nodesCol].length>
0?V(a,b[a.nodesCol][0]):V(a,b)}function wa(a,b){if(b&&b[a.nodesCol]){for(var c=0;c<b[a.nodesCol].length;c++)b[a.nodesCol][c][a.nodesCol]&&wa(a,b[a.nodesCol][c]);ya(a,b)}}function ya(a,b){if(b){var c=true,d=true;if(b[a.nodesCol])for(var e=0;e<b[a.nodesCol].length;e++){if(a.checkStyle==J&&(b[a.nodesCol][e][a.checkedCol]||!b[a.nodesCol][e].check_True_Full))c=false;else if(a.checkStyle!=J&&b[a.checkedCol]&&(!b[a.nodesCol][e][a.checkedCol]||!b[a.nodesCol][e].check_True_Full))c=false;else if(a.checkStyle!=
J&&!b[a.checkedCol]&&(b[a.nodesCol][e][a.checkedCol]||!b[a.nodesCol][e].check_False_Full))d=false;if(!c||!d)break}b.check_True_Full=c;b.check_False_Full=d;c=f("#"+b.tId+D);y(a,c,b)}}function W(a){var b=za[a.data.treeObjId];a=a.data.treeNode;b.expandTriggerFlag=true;if(a.open){var c=true;if(typeof b.callback.beforeCollapse=="function")c=b.callback.beforeCollapse(b.treeObjId,a);if(c==false){b.expandTriggerFlag=false;return}}else{c=true;if(typeof b.callback.beforeExpand=="function")c=b.callback.beforeExpand(b.treeObjId,
a);if(c==false){b.expandTriggerFlag=false;return}}sa(b,a)}function sa(a,b){if(b&&b[a.nodesCol]&&b[a.nodesCol].length>0)B(a,b,!b.open);else a.async&&!a.editable&&Aa(a,b)}function Aa(a,b){if(!(b&&(b.isAjaxing||!b.isParent))){if(b){b.isAjaxing=true;f("#"+b.tId+s).attr("class","ico_loading")}for(var c="",d=0;b&&d<a.asyncParam.length;d++)c+=(c.length>0?"&":"")+a.asyncParam[d]+"="+b[a.asyncParam[d]];for(d=0;d<a.asyncParamOther.length;d+=2)c+=(c.length>0?"&":"")+a.asyncParamOther[d]+"="+a.asyncParamOther[d+
1];d=a.asyncUrl;if(typeof a.asyncUrl=="function")d=a.asyncUrl(b);f.ajax({type:"POST",url:d,data:c,success:function(e){if(!(!e||e.length==0)){var g="";try{g=typeof e=="string"?eval("("+e+")"):e}catch(h){}C(a,b);g&&g!=""&&Ua(a,b,g,false);if(b)b.isAjaxing=undefined;f("#"+a.treeObjId).trigger(ka,[a.treeObjId,b,e])}},error:function(e,g,h){a.expandTriggerFlag=false;C(a,b);if(b)b.isAjaxing=undefined;f("#"+a.treeObjId).trigger(la,[a.treeObjId,b,e,g,h])}})}}function B(a,b,c,d,e){if(!b||b.open==c)typeof e==
"function"&&e();else{if(a.expandTriggerFlag){e=function(){b.open?f("#"+a.treeObjId).trigger(ia,[a.treeObjId,b]):f("#"+a.treeObjId).trigger(ja,[a.treeObjId,b])};a.expandTriggerFlag=false}c=f("#"+b.tId+v);var g=f("#"+b.tId+s),h=f("#"+b.tId+r);if(b.isParent&&b[a.nodesCol]&&b[a.nodesCol].length>0)if(b.open){A(c,H);K(g,H);b.open=false;if(d==false){h.hide();typeof e=="function"&&e()}else h.hide(a.expandSpeed,e)}else{A(c,G);K(g,G);b.open=true;if(d==false){h.show();typeof e=="function"&&e()}else h.show(a.expandSpeed,
e)}else typeof e=="function"&&e()}}function Ba(a,b,c,d,e){var g=b?b[a.nodesCol]:a.root[a.nodesCol],h=b?false:d;if(g)for(var i=0;i<g.length;i++)g[i]&&Ba(a,g[i],c,h);B(a,b,c,d,e)}function S(a,b,c,d,e){if(b)if(b.parentNode){B(a,b,c,d);b.parentNode&&S(a,b.parentNode,c,d,e)}else B(a,b,c,d,e)}function xa(a,b,c){var d=f("#"+b.tId+D);b[a.checkedCol]=c;y(a,d,b);if(b.parentNode){d=true;if(!c)for(var e=0;e<b.parentNode[a.nodesCol].length;e++)if(b.parentNode[a.nodesCol][e][a.checkedCol]){d=false;break}d&&xa(a,
b.parentNode,c)}}function ca(a,b,c){if(b){var d=f("#"+b.tId+D);if(b!=a.root){b[a.checkedCol]=c;y(a,d,b)}if(b[a.nodesCol])for(d=0;d<b[a.nodesCol].length;d++)b[a.nodesCol][d]&&ca(a,b[a.nodesCol][d],c)}}function Va(a,b,c){if(c){c.level=b?b.level+1:0;if(c[a.nodesCol])for(b=0;b<c[a.nodesCol].length;b++)c[a.nodesCol][b]&&Va(a,c,c[a.nodesCol][b])}}function Ua(a,b,c,d){if(a.isSimpleData)c=Ca(a,c);if(b){if(f("#"+a.treeObjId).find("#"+b.tId).length!=0){target_switchObj=f("#"+b.tId+v);target_icoObj=f("#"+b.tId+
s);target_aObj=f("#"+b.tId+o);target_ulObj=f("#"+b.tId+r);if(!b.open){A(target_switchObj,H);K(target_icoObj,H);b.open=false;target_ulObj.css({display:"none"})}if(!b.isParent){target_switchObj.unbind("click");target_switchObj.bind("click",function(){B(a,b,!b.open)});target_aObj.unbind("dblclick");target_aObj.bind("dblclick",{treeObjId:a.treeObjId,treeNode:b},W)}Wa(a,b,c);M(a,b.level+1,c,b);d||S(a,b,true)}}else{Wa(a,a.root,c);M(a,0,c,null)}}function Wa(a,b,c){b[a.nodesCol]||(b[a.nodesCol]=[]);if(b[a.nodesCol].length>
0){b[a.nodesCol][b[a.nodesCol].length-1].isLastNode=false;C(a,b[a.nodesCol][b[a.nodesCol].length-1])}b.isParent=true;b[a.nodesCol]=b[a.nodesCol].concat(c)}function Oa(a,b,c,d,e){if(b!=c){var g=c.parentNode==null?a.root:c.parentNode,h=b===null||b==a.root;if(h&&b===null)b=a.root;if(h)d=z;var i=b.parentNode?b.parentNode:a.root;if(d!=Q&&d!=Z)d=z;var p=-1,t=0,k=null,j=null;if(c.isFirstNode){p=0;if(g[a.nodesCol].length>1){k=g[a.nodesCol][1];k.isFirstNode=true}}else if(c.isLastNode){p=g[a.nodesCol].length-
1;k=g[a.nodesCol][p-1];k.isLastNode=true}else for(var w=0;w<g[a.nodesCol].length;w++)if(g[a.nodesCol][w].tId==c.tId)p=w;p>=0&&g[a.nodesCol].splice(p,1);if(d!=z)for(w=0;w<i[a.nodesCol].length;w++)if(i[a.nodesCol][w].tId==b.tId)t=w;if(d==z){if(h)c.parentNode=null;else{b.isParent=true;c.parentNode=b}b[a.nodesCol]||(b[a.nodesCol]=[]);if(b[a.nodesCol].length>0){j=b[a.nodesCol][b[a.nodesCol].length-1];j.isLastNode=false}b[a.nodesCol].splice(b[a.nodesCol].length,0,c);c.isLastNode=true;c.isFirstNode=b[a.nodesCol].length==
1}else if(b.isFirstNode&&d==Q){i[a.nodesCol].splice(t,0,c);j=b;j.isFirstNode=false;c.parentNode=b.parentNode;c.isFirstNode=true;c.isLastNode=false}else if(b.isLastNode&&d==Z){i[a.nodesCol].splice(t+1,0,c);j=b;j.isLastNode=false;c.parentNode=b.parentNode;c.isFirstNode=false;c.isLastNode=true}else{d==Q?i[a.nodesCol].splice(t,0,c):i[a.nodesCol].splice(t+1,0,c);c.parentNode=b.parentNode;c.isFirstNode=false;c.isLastNode=false}Va(a,c.parentNode,c);f("#"+c.tId+v);f("#"+c.tId+r);var m,x,P;if(h)p=i=f("#"+
a.treeObjId);else{i=f("#"+b.tId);m=f("#"+b.tId+v);x=f("#"+b.tId+s);P=f("#"+b.tId+o);p=f("#"+b.tId+r)}if(d==z){A(m,G);K(x,G);b.open=true;p.css({display:"block"});if(!b.isParent&&!h){m.unbind("click");m.bind("click",function(){B(a,b,!b.open)});P.unbind("dblclick");P.bind("dblclick",{treeObjId:a.treeObjId,treeNode:b},W)}p.append(f("#"+c.tId).detach())}else if(d==Q)i.before(f("#"+c.tId).detach());else d==Z&&i.after(f("#"+c.tId).detach());C(a,c);if(g[a.nodesCol].length<1){g.isParent=false;d=f("#"+g.tId+
r);h=f("#"+g.tId+v);k=f("#"+g.tId+s);A(h,E);K(k,E);d.css("display","none")}else k&&C(a,k);j&&C(a,j);if(a.checkable){ya(a,g);O(a,g);g!=c.parent&&O(a,c)}S(a,c.parentNode,true,e)}}function Ra(a,b){var c=b.parentNode==null?a.root:b.parentNode;if(a.curTreeNode===b)a.curTreeNode=null;if(a.curEditTreeNode===b)a.curEditTreeNode=null;f("#"+b.tId).remove();for(var d=-1,e=0;e<c[a.nodesCol].length;e++)if(c[a.nodesCol][e].tId==b.tId)d=e;d>=0&&c[a.nodesCol].splice(d,1);if(c[a.nodesCol].length<1){c.isParent=false;
c.open=false;d=f("#"+c.tId+r);e=f("#"+c.tId+v);c=f("#"+c.tId+s);A(e,E);K(c,E);d.css("display","none")}else if(a.showLine){c[a.nodesCol][c[a.nodesCol].length-1].isLastNode=true;c[a.nodesCol][c[a.nodesCol].length-1].isFirstNode=c[a.nodesCol].length==1;d=f("#"+c[a.nodesCol][c[a.nodesCol].length-1].tId+r);e=f("#"+c[a.nodesCol][c[a.nodesCol].length-1].tId+v);f("#"+c[a.nodesCol][c[a.nodesCol].length-1].tId+s);if(c==a.root)if(c[a.nodesCol].length==1)A(e,ta);else{c=f("#"+c[a.nodesCol][0].tId+v);A(c,ua);A(e,
ba)}else A(e,ba);d.removeClass(va)}}function U(a,b){return Da(a,a.root[a.nodesCol],"tId",b)}function Da(a,b,c,d){if(!b||!c)return null;for(var e=0;e<b.length;e++){if(b[e][c]==d)return b[e];var g=Da(a,b[e][a.nodesCol],c,d);if(g)return g}return null}function Xa(a,b,c,d){if(!b||!c)return[];for(var e=[],g=0;g<b.length;g++){b[g][c]==d&&e.push(b[g]);e=e.concat(Xa(a,b[g][a.nodesCol],c,d))}return e}function Ya(a){if(a.curTreeNode){f("#"+a.curTreeNode.tId+o).removeClass(pa);f("#"+a.curTreeNode.tId+I).text(a.curTreeNode[a.nameCol]);
a.curTreeNode=null}}function Za(a){if(a.curEditTreeNode){f("#"+a.curEditTreeNode.tId+o).removeClass($a);f("#"+a.curEditTreeNode.tId+Ea).unbind();f("#"+a.curEditTreeNode.tId+I).text(a.curEditTreeNode[a.nameCol]);a.curEditTreeNode.editNameStatus=false;a.curEditTreeNode=null}}function N(a,b){if(!(a.curTreeNode==b&&!a.editable)){Ya(a);Za(a);if(b.editNameStatus){f("#"+b.tId+I).html("<input type=text class='rename' id='"+b.tId+Ea+"'>");var c=f("#"+b.tId+Ea);c.attr("value",b[a.nameCol]);c.focus();hb(c.get(0),
b[a.nameCol].length);c.bind("blur",function(){ab(this.value,a,b)}).bind("keydown",function(d){d.keyCode=="13"&&ab(this.value,a,b)}).bind("click",function(){return false}).bind("dblclick",function(){return false});f("#"+b.tId+o).addClass($a);a.curEditTreeNode=b}else f("#"+b.tId+o).addClass(pa);a.curTreeNode=b}}function ab(a,b,c){c[b.nameCol]=a;f("#"+b.treeObjId).trigger(fa,[b.treeObjId,c]);Za(b);N(b,c)}function bb(a,b,c){if(!b)return[];for(var d=[],e=0;e<b.length;e++){if(b[e][a.checkedCol]==c)d=d.concat([b[e]]);
var g=bb(a,b[e][a.nodesCol],c);if(g.length>0)d=d.concat(g)}return d}function cb(a,b){if(!b)return[];for(var c=[],d=0;d<b.length;d++){if(b[d][a.checkedCol]!=b[d].checkedOld)c=c.concat([b[d]]);var e=cb(a,b[d][a.nodesCol]);if(e.length>0)c=c.concat(e)}return c}function Ca(a,b){var c=a.treeNodeKey,d=a.treeNodeParentKey;if(!c||c==""||!b)return[];if(Object.prototype.toString.apply(b)==="[object Array]"){for(var e=[],g=[],h=0;h<b.length;h++){if(b[h][d]&&g[b[h][d]]){g[b[h][d]][a.nodesCol]||(g[b[h][d]][a.nodesCol]=
[]);g[b[h][d]][a.nodesCol].push(b[h])}else e.push(b[h]);g[b[h][c]]=b[h]}return e}else return[b]}function Fa(a,b){if(!b)return[];var c=[];if(Object.prototype.toString.apply(b)==="[object Array]")for(var d=0;d<b.length;d++){c.push(b[d]);if(b[d][a.nodesCol])c=c.concat(Fa(a,b[d][a.nodesCol]))}else{c.push(b);if(b[a.nodesCol])c=c.concat(Fa(a,b[a.nodesCol]))}return c}function mb(){return{container:null,setting:null,init:function(a){this.container=a;this.setting=za[a.attr("id")];return this},refresh:function(){f("#"+
setting.treeObjId).empty();this.setting.curTreeNode=null;this.setting.curEditTreeNode=null;this.setting.dragStatus=0;this.setting.dragNodeShowBefore=false;this.setting.checkRadioCheckedList=[];na=0;M(this.setting,0,this.setting.root[this.setting.nodesCol])},setEditable:function(a){this.setting.editable=a;return this.refresh()},transformTozTreeNodes:function(a){return Ca(this.setting,a)},transformToArray:function(a){return Fa(this.setting,a)},getNodes:function(){return this.setting.root[this.setting.nodesCol]},
getSelectedNode:function(){return this.setting.curTreeNode},getCheckedNodes:function(a){a=a!=false;return bb(this.setting,this.setting.root[this.setting.nodesCol],a)},getChangeCheckedNodes:function(){return cb(this.setting,this.setting.root[this.setting.nodesCol])},getNodeByTId:function(a){if(a)return U(this.setting,a)},getNodeByParam:function(a,b){if(a)return Da(this.setting,this.setting.root[this.setting.nodesCol],a,b)},getNodesByParam:function(a,b){if(a)return Xa(this.setting,this.setting.root[this.setting.nodesCol],
a,b)},getNodeIndex:function(a){if(a){for(var b=a.parentNode==null?this.setting.root:a.parentNode,c=0;c<b[this.setting.nodesCol].length;c++)if(b[this.setting.nodesCol][c]==a)return c;return-1}},getSetting:function(){var a=this.setting,b={checkType:{},callback:{}},c=a.checkType;a.checkType=undefined;var d=a.callback;a.callback=undefined;var e=a.root;a.root=undefined;f.extend(b,a);a.checkType=c;a.callback=d;a.root=e;f.extend(true,b.checkType,c);f.extend(b.callback,d);return b},updateSetting:function(a){if(a){var b=
this.setting,c=b.treeObjId,d=a.checkType;a.checkType=undefined;var e=a.callback;a.callback=undefined;var g=a.root;a.root=undefined;f.extend(b,a);a.checkType=d;a.callback=e;a.root=g;f.extend(true,b.checkType,d);f.extend(b.callback,e);b.treeObjId=c;b.treeObj=this.container}},expandAll:function(a){Ba(this.setting,null,a,true)},expandNode:function(a,b,c){if(a){if(b){a.parentNode&&S(this.setting,a.parentNode,b,false);B(this.setting,a,b,true)}if(c)Ba(this.setting,a,b,false,function(){f("#"+a.tId+s).focus().blur()});
else if(a.open!=b){sa(this.setting,a);f("#"+a.tId+s).focus().blur()}}},selectNode:function(a){if(a){N(this.setting,a);S(this.setting,a,true,false,function(){f("#"+a.tId+s).focus().blur()})}},cancleSelectedNode:function(){this.cancelSelectedNode()},cancelSelectedNode:function(){Ya(this.setting)},checkAllNodes:function(a){this.setting.checkable&&ca(this.setting,this.setting.root,a==true)},reAsyncChildNodes:function(a,b){if(this.setting.async){var c=!a;if(c)a=this.setting.root;if(b=="refresh"){a[this.setting.nodesCol]=
[];c?this.setting.treeObj.empty():f("#"+a.tId+r).empty()}Aa(this.setting,c?null:a)}},addNodes:function(a,b,c){if(b){a||(a=null);Ua(this.setting,a,b,c==true)}},updateNode:function(a,b){if(a){var c=f("#"+a.tId+D);if(this.setting.checkable){b==true&&Ia(this.setting,a);y(this.setting,c,a);O(this.setting,a)}Ha(this.setting,a);Ja(a);Ka(this.setting,a);C(this.setting,a)}},moveNode:function(a,b,c){if(b)if(!(a&&(b.parentNode==a&&c==z||f("#"+b.tId).find("#"+a.tId).length>0))){a||(a=null);Oa(this.setting,a,
b,c,false)}},removeNode:function(a){a&&Ra(this.setting,a)}}}var da="ZTREE_CLICK",ea="ZTREE_CHANGE",fa="ZTREE_RENAME",ga="ZTREE_REMOVE",ha="ZTREE_DRAG",T="ZTREE_DROP",ia="ZTREE_EXPAND",ja="ZTREE_COLLAPSE",ka="ZTREE_ASYNC_SUCCESS",la="ZTREE_ASYNC_ERROR",v="_switch",s="_ico",I="_span",Ea="_input",D="_check",R="_edit",L="_remove",r="_ul",o="_a",ta="root",ua="roots",Pa="center",ba="bottom",Qa="noLine",va="line",G="open",H="close",E="docu",pa="curSelectedNode",$a="curSelectedNode_Edit",qa="tmpTargetTree",
ra="tmpTargetNode",J="radio",lb="chk",jb="false",ib="true",Sa="full",Ta="part",kb="focus",oa="all",z="inner",Q="before",Z="after",Ma="5",za=[],na=0;f.fn.zTree=function(a,b){var c={treeObjId:"",checkable:false,editable:false,edit_renameBtn:true,edit_removeBtn:true,showLine:true,curTreeNode:null,curEditTreeNode:null,dragStatus:0,dragNodeShowBefore:false,checkStyle:"checkbox",checkType:{Y:"ps",N:"ps"},checkRadioType:"level",checkRadioCheckedList:[],async:false,asyncUrl:"",asyncParam:[],asyncParamOther:[],
isSimpleData:false,treeNodeKey:"",treeNodeParentKey:"",nameCol:"name",nodesCol:"nodes",checkedCol:"checked",expandSpeed:"fast",expandTriggerFlag:false,root:{isRoot:true,nodes:[]},callback:{beforeClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeChange:null,beforeDrag:null,beforeDrop:null,beforeRename:null,beforeRemove:null,beforeExpand:null,beforeCollapse:null,click:null,rightClick:null,mouseDown:null,mouseUp:null,change:null,drag:null,drop:null,rename:null,remove:null,
expand:null,collapse:null,asyncSuccess:null,asyncError:null}};if(a){var d=a.checkType;a.checkType=undefined;var e=a.callback;a.callback=undefined;var g=a.root;a.root=undefined;f.extend(c,a);a.checkType=d;f.extend(true,c.checkType,d);a.callback=e;f.extend(c.callback,e);a.root=g;f.extend(c.root,g)}c.treeObjId=this.attr("id");c.treeObj=this;c.root.tId=-1;c.root.name="ZTREE ROOT";c.root.isRoot=true;c.checkRadioCheckedList=[];c.curTreeNode=null;c.curEditTreeNode=null;c.dragNodeShowBefore=false;c.dragStatus=
0;c.expandTriggerFlag=false;c.root[c.nodesCol]||(c.root[c.nodesCol]=[]);na=0;if(b)c.root[c.nodesCol]=b;if(c.isSimpleData)c.root[c.nodesCol]=Ca(c,c.root[c.nodesCol]);za[c.treeObjId]=c;f("#"+c.treeObjId).empty();db(c,this);if(c.root[c.nodesCol]&&c.root[c.nodesCol].length>0)M(c,0,c.root[c.nodesCol]);else c.async&&c.asyncUrl&&c.asyncUrl.length>0&&Aa(c);return(new mb).init(this)};var aa=[]})(jQuery);